<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons"><title data-react-helmet="true">Thunk Functions | IOTA Smart Contract Protocol</title><meta data-react-helmet="true" property="og:url" content="https://iscp.docs.iota.org/docs/guide/schema/thunks/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Thunk Functions | IOTA Smart Contract Protocol"><meta data-react-helmet="true" name="description" content="In computer programming, a thunk is a function used to inject a calculation into another"><meta data-react-helmet="true" property="og:description" content="In computer programming, a thunk is a function used to inject a calculation into another"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://iscp.docs.iota.org/docs/guide/schema/thunks/"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/guide/schema/thunks/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://iscp.docs.iota.org/docs/guide/schema/thunks/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c3cdf61a.css">
<link rel="preload" href="/assets/js/runtime~main.214b6a02.js" as="script">
<link rel="preload" href="/assets/js/main.5ac8063b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo/WASP_logo_dark.png" alt="IOTA" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ISCP</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/overview/">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview/">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Core Concepts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ISCP Chains and Nodes</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Rust/WASM</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/rust_wasm/introduction/">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Schema tool</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/intro/">Smart Contract Schemas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/proxies/">Data Access Proxies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/types/">WasmLib Data Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/context/">Function Call Context</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/schema/">Smart Contract Schema Tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/usage/">Using the Schema Tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/structs/">Structured Data Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/typedefs/">Type Definitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/state/">Smart Contract State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/funcs/">Function Definitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/access/">Limiting Access</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/params/">Function Parameters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/results/">Function Results</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/guide/schema/thunks/">Thunk Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/views/">View-Only Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/init/">Smart Contract Initialization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/transfers/">Token Transfers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/funcdesc/">Function Descriptors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/call/">Calling Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/post/">Posting Asynchronous Requests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/test/">Testing Smart Contracts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/examples/">Example Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/schema/timelock/">Colored Tokens and Time Locks</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">EVM</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Example projects</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/contribute/">Contribute</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Thunk Functions</h1></header><p>In computer programming, a thunk is a function used to inject a calculation into another
function. Thunks are used to insert operations at the beginning or end of the other
function to adapt it to changing requirements. If you remember from
the <a href="/docs/guide/schema/context/">function call context</a> section, the <code>on_load</code> function and skeleton
function signatures looked like this:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Rust</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">OnLoad</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewScExports</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;divide&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcDivide</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;init&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcInit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;member&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcMember</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;setOwner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcSetOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;getFactor&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> viewGetFactor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;getOwner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> viewGetOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">funcDivide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScFuncContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">funcInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScFuncContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">funcMember</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScFuncContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">funcSetOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScFuncContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">viewGetFactor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScViewContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">viewGetOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScViewContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">fn on_load() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let exports = ScExports::new();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(&quot;divide&quot;, func_divide);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(&quot;init&quot;, func_init);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(&quot;member&quot;, func_member);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(&quot;setOwner&quot;, func_set_owner);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_view(&quot;getFactor&quot;, view_get_factor);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_view(&quot;getOwner&quot;, view_get_owner);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn func_divide(ctx: &amp;ScFuncContext) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn func_init(ctx: &amp;ScFuncContext) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn func_member(ctx: &amp;ScFuncContext) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn func_set_owner(ctx: &amp;ScFuncContext) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn view_get_factor(ctx: &amp;ScViewContext) {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn view_get_owner(ctx: &amp;ScViewContext) {}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><p>Now that the schema tool introduces a bunch of automatically generated features, that is
no longer sufficient. Luckily, the schema tool also generates thunks to inject these
features, before calling the function implementations that are maintained by the user.
Here is the new <code>on_load</code> function for the <code>dividend</code> contract:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Rust</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">OnLoad</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewScExports</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FuncDivide</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcDivideThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FuncInit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcInitThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FuncMember</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcMemberThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddFunc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FuncSetOwner</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcSetOwnerThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ViewGetFactor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> viewGetFactorThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddView</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ViewGetOwner</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> viewGetOwnerThunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">range</span><span class="token plain"> keyMap </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        idxMap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">KeyID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">fn on_load() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let exports = ScExports::new();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(FUNC_DIVIDE, func_divide_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(FUNC_INIT, func_init_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(FUNC_MEMBER, func_member_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_func(FUNC_SET_OWNER, func_set_owner_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_view(VIEW_GET_FACTOR, view_get_factor_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    exports.add_view(VIEW_GET_OWNER, view_get_owner_thunk);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsafe {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in 0..KEY_MAP_LEN {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            IDX_MAP[i] = get_key_id_from_string(KEY_MAP[i]);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><p>As you can see instead of calling the user functions directly, we now call thunk versions
of these functions. We also added initialization of a local array that holds all key IDs
negotiated with the host, so that we can simply use (generated) indexes into this array
instead of having to negotiate these IDs each time we need them. The rest of the generated
code will use those indexes whenever a known key is used.</p><p>Here is an example of a thunk function for the <code>setOwner</code> contract function. You can
examine the other thunks that all follow the same pattern in the generated <code>lib.rs</code>:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Go</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Rust</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> SetOwnerContext </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Params ImmutableSetOwnerParams</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    State  MutableDividendState</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">funcSetOwnerThunk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ScFuncContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dividend.funcSetOwner&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// only defined owner of contract can change owner</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    access </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">State</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetAgentID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;owner&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">access</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;access not set: owner&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Caller</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> access</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;no permission&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    f </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">SetOwnerContext</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ImmutableSetOwnerParams</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">           id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OBJ_ID_PARAMS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        State</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MutableDividendState</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wasmlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OBJ_ID_STATE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Owner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;missing mandatory owner&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">funcSetOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dividend.funcSetOwner ok&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct SetOwnerContext {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    params: ImmutableSetOwnerParams,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    state:  MutableDividendState,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn func_set_owner_thunk(ctx: &amp;ScFuncContext) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.log(&quot;dividend.funcSetOwner&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // only defined owner of contract can change owner</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let access = ctx.state().get_agent_id(&quot;owner&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.require(access.exists(), &quot;access not set: owner&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.require(ctx.caller() == access.value(), &quot;no permission&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let f = SetOwnerContext {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        params: ImmutableSetOwnerParams {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            id: OBJ_ID_PARAMS,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        state: MutableDividendState {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            id: OBJ_ID_STATE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.require(f.params.owner().exists(), &quot;missing mandatory owner&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    func_set_owner(ctx, &amp;f);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx.log(&quot;dividend.funcSetOwner ok&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><p>The thunk first logs the contract and function name to show the call has started. Then it
sets up the access control for the function according to the schema definition file.
In this case it retrieves the <code>owner</code> state variable, requires that it exists, and then
requires that the caller() of the function equals that value. Any failing requirement will
panic out of the function with an error message. So this code makes sure only the owner of
the contract can call this function.</p><p>Next we set up a strongly typed function-specific context structure. First we add the
function-specific immutable <code>params</code> interface structure, which is only present when the
function can have parameters. Then we add the contract-specific <code>state</code> interface
structure. In this case it is mutable because setOwner is a Func. For Views this will be
an immutable state interface. Finally, we add the function-specific mutable <code>results</code>
interface structure, which is only present when the function returns results. Obviously,
this is not the case for this setOwner function.</p><p>Now we get to the point where we can use the function-specific <code>params</code> interface to check
for mandatory parameters. Each mandatory parameter is required to exist, or else we will
panic out of the function with an error message.</p><p>With the automated checks and setup completed we now call the function implementation that
is maintained by the user. After the user function has completed we log that the contract
function has completed successfully. Remember that any error within the user function will
cause a panic, so this logging will never happen in that case.</p><p>In the next section we will look at the specifics of view functions.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/iotaledger/chronicle.rs/tree/main/docs/docs/guide/schema/thunks.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/guide/schema/results/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Function Results</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/guide/schema/views/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">View-Only Functions Â»</div></a></div></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/overview/">Overview</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 IOTA Foundation, Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.214b6a02.js"></script>
<script src="/assets/js/main.5ac8063b.js"></script>
</body>
</html>